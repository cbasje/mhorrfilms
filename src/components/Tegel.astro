---
import Icon from "astro-icon";
import type { CollectionEntry } from "astro:content";

export interface Props {
    index: number;
    tegel: CollectionEntry<"tegels">;
}

const { index, tegel } = Astro.props;
const { Content, headings } = await tegel.render();
---

<li is="tegel-wrapper" data-index={index} aria-label="Tegel">
    <a class="duim-nagel" role="banner">
        <img
            src={`plaatjes/duimnagels/${tegel.data.duimnagelBestand}`}
            alt={`${headings.at(0)?.text ?? "Tegel"} video thumbnail`}
            loading="lazy"
        />
        <div class="overlay" aria-hidden="true"></div>
        <h3>{headings.at(0)?.text ?? "Tegel"}</h3>
    </a>
    <div class="beschrijving">
        <Content />

        <iframe
            src={`https://www.youtube-nocookie.com/embed/${tegel.data.youtubeId}`}
            title={`${headings.at(0)?.text ?? "Tegel"} video`}
            allow="encrypted-media; picture-in-picture"
            allowfullscreen></iframe>
    </div>
    <button aria-label="Open beschrijving van deze tegel">
        <Icon pack="ph" name="caret-right" aria-hidden />
    </button>
</li>

<script>
    class TegelWrapper extends HTMLLIElement {
        constructor() {
            super();

            let isOpen = false;

            const toggleTegel = () => {
                if (isOpen) this.classList.remove("tegel-open");
                else this.classList.add("tegel-open");

                isOpen = !isOpen;
            };

            const button = this.querySelector<HTMLButtonElement>("button")!;
            button.addEventListener("click", () => toggleTegel());

            const duimNagel =
                this.querySelector<HTMLAnchorElement>("a.duim-nagel")!;
            duimNagel.addEventListener("click", () => toggleTegel());
        }
    }

    customElements.define("tegel-wrapper", TegelWrapper, { extends: "li" });
</script>

<style lang="scss">
    li[is="tegel-wrapper"] {
        width: 100%;
        max-width: 800px;
        height: auto;
        aspect-ratio: 16 / 9;
        position: relative;
        list-style: none;
        background-color: rgba(200, 200, 200, 0.1);
        border-radius: 0.25rem;
        overflow: hidden;

        transition: 0.2s ease-out;

        button {
            all: unset;
            cursor: pointer;

            position: absolute;
            right: 0px;
            bottom: 0px;

            > svg {
                width: 2.5rem;
                height: 2.5rem;
                rotate: 45deg;
                transition: rotate 0.2s ease-out;
                color: var(--accentkleur);
            }
        }

        a.duim-nagel {
            display: block;
            width: 100%;
            height: auto;
            aspect-ratio: 16 / 9;

            position: relative;
            isolation: isolate;

            img {
                position: absolute;
                inset: 0px;
                width: 100%;
                height: 100%;
                object-fit: cover;
            }

            div.overlay {
                position: absolute;
                inset: 0px;
                width: 100%;
                height: 100%;
                background-image: linear-gradient(
                    160deg,
                    rgba(0, 0, 0, 0),
                    rgba(0, 0, 0, 0.7)
                );
                z-index: 2;
                transition: 0.9s ease-out;
            }

            h3 {
                position: absolute;
                inset-inline: 0px;
                bottom: 0px;
                width: 85%;
                margin-inline: 2rem;
                margin-block: 1.5rem;
                z-index: 3;
            }
        }

        div.beschrijving {
            display: flex;
            flex-direction: column;
            gap: 2rem;
            padding-block: 2rem;
            padding-inline: 1rem;

            > :global(p) {
                margin: 0;

                :global(img) {
                    width: 100%;
                    max-width: 500px;
                    height: auto;
                    aspect-ratio: 16 / 9;
                    object-fit: cover;
                }
            }
        }

        &.tegel-open {
            max-width: 100%;
            aspect-ratio: auto;

            button > svg {
                rotate: -135deg;
            }
        }

        &:hover a.duim-nagel div.overlay {
            opacity: 0;
        }
    }

    @media only screen and (width < 678px) {
        li[is="tegel-wrapper"] {
            button > svg {
                width: 2rem;
                height: 2rem;
            }

            a.duim-nagel h3 {
                margin-inline: 1rem;
                margin-block: 0.5rem;
            }
        }
    }
</style>
